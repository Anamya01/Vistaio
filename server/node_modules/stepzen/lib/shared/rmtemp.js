"use strict";
// Copyright IBM Corp. 2020, 2024
Object.defineProperty(exports, "__esModule", { value: true });
exports.rmtemp = void 0;
const fs = require("fs");
const path = require("path");
const os = require("os");
const debug = require("debug");
/**
 * Verify that the given path is indeed inside the tmp folder,
 * and delete it recursively suppressing any errors.
 *
 * If the given path is not inside the tmp folder, do nothing.
 *
 * @param {*} fileOrDirPath path to a temp file or folder to delete
 */
const rmtemp = (fileOrDirPath) => {
    if (!fileOrDirPath) {
        return;
    }
    // https://stackoverflow.com/a/45242825
    const relative = path.relative(os.tmpdir(), fileOrDirPath);
    const isInTemp = relative && !relative.startsWith('..') && !path.isAbsolute(relative);
    if (isInTemp) {
        try {
            fs.rmSync(fileOrDirPath, { recursive: true, force: true });
        }
        catch (error) {
            // ignore errors
            debug('stepzen:rmtemp')(`WARN: caught an exception while deleting ${fileOrDirPath}: `, error);
        }
    }
    else {
        debug('stepzen:rmtemp')(`WARN: got a temp path ${fileOrDirPath} out of the TMP folder -- ignoring`);
    }
};
exports.rmtemp = rmtemp;
exports.default = exports.rmtemp;
//# sourceMappingURL=rmtemp.js.map