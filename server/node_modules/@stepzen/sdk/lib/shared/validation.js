"use strict";
// Copyright IBM Corp. 2020, 2024
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateSchema = exports.validateConfigurationset = void 0;
const debug = require("debug");
const fs = require("fs");
const glob = require("glob");
const yaml = require("yaml");
// Validate the Configurationset file
const validateConfigurationset = async (file) => {
    if (!file) {
        debug('stepzen:sdk')(`validateConfigurationset() expected 'file' to be a` +
            ` non-empty string but got ${file}`);
        throw new Error('You must provide a file path');
    }
    if (!fs.existsSync(file)) {
        debug('stepzen:sdk')(`validateConfigurationset() expected ${file} to exist`);
        throw new Error('The file does not exist');
    }
    const content = fs.readFileSync(file, 'utf8');
    // Ensure the file is valid YAML
    try {
        yaml.parse(content);
    }
    catch (error) {
        debug('stepzen:sdk')(`validateConfigurationset() expected ${file} to parse as YAML,` +
            ` but got an error ${error}`);
        throw new Error('The file is not valid YAML');
    }
};
exports.validateConfigurationset = validateConfigurationset;
// Validate the Schema directory
const validateSchema = async (directory) => {
    if (!directory) {
        throw new Error('You must provide a directory path');
    }
    if (!fs.existsSync(directory)) {
        throw new Error('The directory does not exist');
    }
    // Ensure there's a root `index.graphql` file
    const allSchemaFiles = glob.sync('index.graphql', { cwd: directory });
    if (allSchemaFiles.length === 0) {
        throw new Error('Schemas must include an `index.graphql` file');
    }
};
exports.validateSchema = validateSchema;
//# sourceMappingURL=validation.js.map