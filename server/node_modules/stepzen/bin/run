#!/usr/bin/env node

const message = `
┌───────────────────────────────────────────────────────────────────┐
│                                                                   │
│  StepZen CLI does not support this version of NodeJS: $$version.  │
│  Please upgrade to NodeJS 14 or newer.                            │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
`

const nodeMajor = parseInt(process.version.match(/\d+\./), 10)
if (nodeMajor > 0 && nodeMajor < 14) {
  const yellow = '\u001B[33m'
  const reset = '\u001B[0m'
  let version = `${process.version}.`
  version += '         '.substring(0, '$$version'.length - version.length + 1)
  console.warn(yellow + message.replace('$$version.', version) + reset)
}

// workaround for https://github.com/oclif/core/issues/630
if (!global.AbortController) {
  const {AbortController} = require('node-abort-controller')
  global.AbortController = AbortController
}

const oclif = require('@oclif/core')
const flush = require('@oclif/core/flush')
const handleError = require('@oclif/core/handle')

oclif
  .run()
  .then(flush)
  .catch(error => {
    return flush().then(() => handleError(error))
  })
